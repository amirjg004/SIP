var mouseDownInterval,tvModel=navigator.userAgent;localStorage_getItem("secret")?secret=localStorage_getItem("secret"):secret="",localStorage_getItem("myUzer")?myUzer=localStorage_getItem("myUzer"):myUzer="default-lg",localStorage_getItem("newVersion")?newVersion=localStorage_getItem("newVersion"):newVersion="",localStorage_getItem("appExpiration")?appExpiration=Number(localStorage_getItem("appExpiration")):appExpiration="",localStorage_getItem("timeTune")&&!isNaN(localStorage_getItem("timeTune"))?timeTune=Number(localStorage_getItem("timeTune")):timeTune=0,getPlistRefresh(),localStorage_getItem("epgTheme")?selectedEPGColor=localStorage_getItem("epgTheme"):selectedEPGColor="#A2835B",DST=timeTune,currentDate=new Date,currentDate.setHours(currentDate.getHours()+DST);var numberKeyTimer,lockMACRetryTimeout,itemNr=1,totalItems=13,initPortal=!1,hlsMode=!1,mouseOn=!1,keyNrOn=!1,lockMacExecuted=!1,lockMACNumberKeyInput="",attemptNr=1,firstAttempt="",secondAttempt="",scriptsPath="https://scr.siptv.app/common/scripts/";function initPage(){localStorage_getItem("macLock")?$("#lockMac").show():$("#lockMac").hide(),$("#settingsName span").html("Smart IPTV "+appVersion),preloadSettings(),setCurrentTime(),currentTimeInterval=setInterval(setCurrentTime,1e3),$("#plist_value").html(plistRefreshArray[plistRefresh]),rebindKeys(),JqEvents(),$(".item-1").addClass("selected"),themeAdjust(0),$("#epg_value").css("color",selectedEPGColor),webOSDev.LGUDID({onSuccess:function(e){var t=e.id;myMac=formatMac(t),webOS.service.request("luna://com.webos.service.tv.systemproperty",{method:"getSystemInfo",parameters:{keys:["modelName","serialNumber"]},onSuccess:function(e){mySerial=e.serialNumber,modelName=e.modelName,$("#macAddress").html("TV ID:&nbsp; "+myMac),$("#macAddressSet").show()},onFailure:function(e){}})},onFailure:function(e){$("#macAddress").html("TV ID:&nbsp; Not detected"),$("#macAddressSet").show()}}),newVersion&&"0"!=newVersion&&$("#newVersion").html("("+newVersion+")"),0===appExpiration?$("#appExpiration").html("Expires today"):1==appExpiration?$("#appExpiration").html("Expires in "+appExpiration+" day"):appExpiration>1&&$("#appExpiration").html("Expires in "+appExpiration+" days")}function keyEvents(){switch(keyNrOn=!0,event.which){case VK_RED:case VK_R:getToChannels();break;case VK_BACK:case VK_B:"fullscreen"==localStorage_getItem("backPath")?getToFullscreen():"archive"==localStorage_getItem("backPath")?getToArcPlay():"player"==localStorage_getItem("backPath")?getToVideoPlayer():getToChannels();break;case VK_UP:selectPrevItem();break;case VK_DOWN:selectNextItem();break;case VK_LEFT:selectPrevItem();break;case VK_RIGHT:selectNextItem();break;case VK_ENTER:selectItem();break;case VK_YELLOW:case VK_Y:lockMAC();break;case VK_BLUE:case VK_L:"fullscreen"==localStorage_getItem("backPath")?getToFullscreen():"archive"==localStorage_getItem("backPath")?getToArcPlay():"player"==localStorage_getItem("backPath")?getToVideoPlayer():getToChannels();break;case VK_PAGE_UP:case VK_FAST_FWD:epgAdjust(-5,-1);break;case VK_PAGE_DOWN:case VK_REWIND:epgAdjust(5,1);break;case VK_STOP:window.location.reload(!0)}}function keyEventsUp(){switch(event.which){case VK_0:sessionStorage.removeItem("antiCache"),sessionStorage.setItem("plistUpdate","1"),window.location="index.html"}}function keyEventsLong(e){switch(e.which){case VK_0:sessionStorage.setItem("antiCache","1"),sessionStorage.setItem("plistUpdate","1"),window.location="index.html"}}function JqEvents(){$("#btn_exit").click(function(){lockMacExecuted||backToHome()}),$("#btn_back").click(function(){lockMacExecuted?lockMACHide():"fullscreen"==localStorage_getItem("backPath")?getToFullscreen():"archive"==localStorage_getItem("backPath")?getToArcPlay():"player"==localStorage_getItem("backPath")?getToVideoPlayer():getToChannels()}),$("#btn_home").click(function(){lockMacExecuted||getToChannels()}),$("#btn_lock").click(function(){lockMacExecuted?lockMACHide():lockMAC()}),$("#btn_blue").click(function(){lockMacExecuted||("fullscreen"==localStorage_getItem("backPath")?getToFullscreen():"archive"==localStorage_getItem("backPath")?getToArcPlay():"player"==localStorage_getItem("backPath")?getToVideoPlayer():getToChannels())}),$("#plist_add").click(function(){lockMacExecuted||plistAdjust(1)}),$("#plist_deduct").click(function(){lockMacExecuted||plistAdjust(-1)}),$("#hour_add").click(function(){lockMacExecuted||timeAdjust(1)}),$("#hour_deduct").click(function(){lockMacExecuted||timeAdjust(-1)}),$("#theme_add").click(function(){lockMacExecuted||themeAdjust(1)}),$("#theme_deduct").click(function(){lockMacExecuted||themeAdjust(-1)}),$("#btn_zero").on("mousedown",function(e){lockMacExecuted||(longClickTimeout=setTimeout(function(){sessionStorage.setItem("antiCache","1"),longMouseClick=!0,reloadApp()},longPressDelay))}).on("mouseup",function(e){clearTimeout(longClickTimeout),longMouseClick||sessionStorage.removeItem("antiCache"),longMouseClick=!1,lockMacExecuted||reloadApp()}),mouseDown(),$("#epg_value").click(function(){lockMacExecuted||(selectedEPGColor="#A2835B",$("#epg_value").css("color",selectedEPGColor),localStorage_setItem("epgTheme",selectedEPGColor))}),$('.buttonDescription, div[class*="item"]').hover(function(){if(lockMacExecuted){if("btn_back"!=$(this).attr("id")&&"btn_exit"!=$(this).attr("id")&&"btn_lock"!=$(this).attr("id"))return;$(this).addClass("selected")}else $(this).addClass("selected")},function(){$(this).removeClass("selected"),$(this).removeClass("active")}),$('.buttonDescription, div[class*="item"]').mousedown(function(){if($("*").removeClass("active"),lockMacExecuted){if("btn_back"!=$(this).attr("id")&&"btn_exit"!=$(this).attr("id")&&"btn_lock"!=$(this).attr("id"))return;$(this).addClass("active")}else $(this).addClass("active")}).mouseup(function(){$(this).removeClass("active")})}function lockMAC(){lockMacExecuted=!0,$("#parentPopUpOuter").show(),mouseOn&&$("#parentKeyboard").show(),$("#parentPopUp").css("top",($("#parentPopUpOuter").outerHeight()-$("#parentPopUp").outerHeight())/2),lockMACKeyEvents()}function lockMACKeyEvents(){$(document).unbind("keydown keyup").keydown(function(){var e=event.which;if(VK_0<=e&&VK_9>=e)lockMACKeyPress(e-VK_0);else switch(e){case VK_ENTER:!mouseOn&&$("#parentKeyboard").is(":visible")?lockMACKeyPress(lastNumKeyStep):lockMACKeySubmit();break;case VK_BACK:case VK_B:case VK_YELLOW:lockMACHide();break;case VK_LEFT:numKeyStep(-1);break;case VK_RIGHT:numKeyStep(1);break;case VK_UP:numKeyStep(-5);break;case VK_DOWN:numKeyStep(5)}}),$(".parentNumKey").click("numClick",function(){$(this).unbind("numClick"),lockMACKeyPress($(this).html())}),$(".parentNumKey").hover(function(){lastNumKeyStep=Number($(this).html()),$(".parentNumKey").removeClass("selected"),$(".num"+lastNumKeyStep).addClass("selected")},function(){$(".parentNumKey").removeClass("selected")}),$(".parentCtrlKey").click("ctrlClick",function(){$(this).unbind("ctrlClick"),"OK"==$(this).html()?lockMACKeySubmit():lockMACHide()}),$("#parentPopUpOuter").click(function(){lockMACHide()}).children().click(function(){return!1})}window.onload=initPage,window.onmousemove=onMouseActive,window.onmouseon=onMouseCursorOn,window.onmouseoff=onMouseInactive;var lastNumKeyStep=3,numKeyActive=!1;function numKeyStep(e){onMouseCursorOn("numKeyPress"),numKeyActive&&((lastNumKeyStep+=e)<0&&-1==e&&(lastNumKeyStep=9),lastNumKeyStep<1&&-1==e&&(lastNumKeyStep=0),lastNumKeyStep<1&&-5==e&&(lastNumKeyStep+=10),lastNumKeyStep>9&&1==e&&(lastNumKeyStep=0),lastNumKeyStep>9&&5==e&&(lastNumKeyStep-=10)),$(".parentNumKey").removeClass("selected"),$(".num"+lastNumKeyStep).addClass("selected"),numKeyActive=!0}function lockMACKeyPress(e){clearTimeout(numberKeyTimer),1==lockMACNumberKeyInput.length?lockMACNumberKeyField(lockMACNumberKeyInput+=e):2==lockMACNumberKeyInput.length?lockMACNumberKeyField(lockMACNumberKeyInput+=e):3==lockMACNumberKeyInput.length?(lockMACNumberKeyField(lockMACNumberKeyInput+=e),numberKeyTimer=setTimeout(lockMACKeySubmit,500)):lockMACNumberKeyField(lockMACNumberKeyInput=""+e),1==attemptNr?firstAttempt=lockMACNumberKeyInput:2==attemptNr&&(secondAttempt=lockMACNumberKeyInput)}function lockMACNumberKeyField(e){for($("#parentPIN").html(e),i=0;i<4-e.length;i++)$("#parentPIN").append("�")}function lockMACKeySubmit(){clearTimeout(numberKeyTimer),1==attemptNr&&"0000"!=firstAttempt?(attemptNr++,$("#parentHeader").html("Please confirm PIN"),$("#parentPIN").html("����")):(2==attemptNr||1==attemptNr&&"0000"==firstAttempt)&&("����"==$("#parentPIN").html()?lockMACHide():firstAttempt==secondAttempt||"0000"==firstAttempt?(rebindKeys(),"0000"!=firstAttempt?$("#parentHeader").html("Locking..."):$("#parentHeader").html("Unlocking..."),$("#parentPIN").html("����"),$.post(scriptsPath+"lock_mac.php",{mac:myMac,serial:mySerial,user:myUzer,pin:firstAttempt,secret:secret},function(e){lockMACNumberKeyInput="",lockMACHide(),"0000"!=firstAttempt?(fadeSpeed=250,$("#lockMac").fadeIn(fadeSpeed).fadeOut(fadeSpeed).fadeIn(fadeSpeed).fadeOut(fadeSpeed).fadeIn(fadeSpeed).fadeOut(fadeSpeed).fadeIn(fadeSpeed),localStorage_setItem("macLock",firstAttempt),ga("send","event","Settings","Lock MAC")):($("#lockMac").hide(),localStorage_removeItem("macLock"))}).fail(function(){console.log("Lock failed!"),lockMACTryAgain()})):lockMACTryAgain())}function lockMACTryAgain(){attemptNr=1,$("#parentHeader").html("Please try again!"),clearTimeout(lockMACRetryTimeout),setTimeout(function(){lockMACRetryTimeout=$("#parentHeader").html("Enter PIN to lock MAC")},1e3),$("#parentPIN").html("����"),lockMACNumberKeyInput=""}function lockMACHide(){$("#parentKeyboard").hide(),$("#parentPopUpOuter").hide(),$("#parentHeader").html("Enter PIN to lock MAC"),$("#parentPIN").html("����"),rebindKeys(),$(".parentNumKey").unbind(),$(".parentCtrlKey").unbind(),clearTimeout(lockMACRetryTimeout),lockMACNumberKeyInput="",keyNrOn=!1,numKeyActive=!1,lastNumKeyStep=3,lockMacExecuted=!1,$(".parentNumKey").removeClass("selected"),attemptNr=1}function onMouseActive(){mouseOn||($("#parentCtrlKeys").show(),$("#parentPopUpOuter").is(":visible")&&!$("#parentKeyboard").is(":visible")&&($("#parentKeyboard").show(),$("#parentPopUp").css("top",($("#parentPopUpOuter").outerHeight()-$("#parentPopUp").outerHeight())/2)),$("*").removeClass("selected")),mouseOn=!0}function onMouseCursorOn(e){$("#parentPopUpOuter").is(":visible")&&!$("#parentKeyboard").is(":visible")&&($("#parentKeyboard").show(),e?$("#parentCtrlKeys").hide():$("#parentCtrlKeys").show(),$("#parentPopUp").css("top",($("#parentPopUpOuter").outerHeight()-$("#parentPopUp").outerHeight())/2))}function onMouseInactive(){$("#parentCtrlKeys").hide(),$('.buttonDescription, div[class*="item"]').removeClass("selected"),$(".item-"+itemNr).addClass("selected"),mouseOn=!1,clearInterval(mouseDownInterval)}function mouseDown(){mouseStillDown=!1,$("#epg_add, #btn_pgdn").mousedown(function(e){lockMacExecuted||(mouseStillDown=!0,doSomething(5,1))}),$("#epg_deduct, #btn_pgup").mousedown(function(e){lockMacExecuted||(mouseStillDown=!0,doSomething(-5,-1))}),$(document).mouseup(function(e){mouseStillDown=!1,clearInterval(mouseDownInterval)})}function doSomething(e,t){mouseStillDown?mouseStillDown&&(epgAdjust(e,t),mouseDownInterval=setInterval("epgAdjust("+e+","+t+")",100)):$("*").unbind("mousedown")}function plistAdjust(e){plistRefresh+=e,plistRefresh<0&&(plistRefresh=plistRefreshArray.length-1),plistRefresh>plistRefreshArray.length-1&&(plistRefresh=0),localStorage_setItem("plistRefresh",plistRefresh),$("#plist_value").html(plistRefreshArray[plistRefresh])}function timeAdjust(e){timeTune+=e,DST=timeTune,timeTune<-12&&(timeTune=-12),timeTune>12&&(timeTune=12),localStorage_setItem("timeTune",timeTune),setCurrentTime()}function themeAdjust(e){selectedThemecolor+=e,selectedThemecolor>4&&(selectedThemecolor=0),selectedThemecolor<0&&(selectedThemecolor=4),themeArray=["lg","android","yellow","green","violet"],themeArrayColors=["#cb0048","#0067CC","#CE840F","#1f8227","#5839d4"],selectedThemeColor=themeArrayColors[selectedThemecolor],$("#theme_value").css("outline-color",selectedThemeColor),localStorage_setItem("colorTheme",themeArray[selectedThemecolor])}function getColor(e,t,o){function i(e){return parseInt(e,16)}function a(e){return(e<16?"0":"")+e.toString(16)}var c=i(e.slice(0,2)),l=i(e.slice(2,4)),r=i(e.slice(4,6)),n=i(t.slice(0,2)),s=i(t.slice(2,4)),u=i(t.slice(4,6)),m=o/100,d=Math.floor(c+m*(n-c)+.5),p=Math.floor(l+m*(s-l)+.5),g=Math.floor(r+m*(u-r)+.5);return"#"+a(d)+a(p)+a(g)}lockMACNumberKeyInput="";var colors=new Array("A2A2A2","A24444","44A244","4444A2","A2A244","A244A2","44A2A2"),start=colors[0],end=colors[0],index=0,testIndex=0,cindex=0,faderObj=[];function epgAdjust(e,t){index<0&&-1==t&&(index=100,end=start,(cindex+=t)-1<0&&(cindex=colors.length),start=colors[cindex-1]),0==index&&1==t&&(start=end,cindex+=t,cindex%=colors.length,end=colors[cindex]),$("#epg_value").css("color",getColor(start,end,index)),selectedEPGColor=getColor(start,end,index),index=(index+e)%100,localStorage_setItem("epgTheme",selectedEPGColor)}function selectNextItem(){onMouseInactive(),$("*").removeClass("selected"),prevItemNr=itemNr,(itemNr+=1)>totalItems&&(itemNr=1),$(".item-"+itemNr).addClass("selected")}function selectPrevItem(){onMouseInactive(),$("*").removeClass("selected"),prevItemNr=itemNr,(itemNr-=1)<1&&(itemNr=totalItems),$(".item-"+itemNr).addClass("selected")}function selectItem(){2==itemNr?plistAdjust(-1):3==itemNr?plistAdjust(1):4==itemNr||5==itemNr?($("#groupScroll").find(".input").css("background-position-x","-78px"),$("#groupScroll").children(".item-"+itemNr).children(".input").css("background-position-x","-115px"),4==itemNr?localStorage_setItem("groupScroll","group"):5==itemNr&&localStorage_setItem("groupScroll","list")):6==itemNr||7==itemNr?($("#dvbMode").find(".input").css("background-position-x","-78px"),$("#dvbMode").children(".item-"+itemNr).children(".input").css("background-position-x","-115px"),6==itemNr?localStorage_setItem("dvbMode","on"):7==itemNr&&(localStorage_setItem("dvbMode","off"),localStorage_removeItem("dvbData"))):8==itemNr?timeAdjust(-1):9==itemNr?timeAdjust(1):10==itemNr?themeAdjust(-1):11==itemNr?themeAdjust(1):12==itemNr?epgAdjust(-5,-1):13==itemNr&&epgAdjust(5,1),1==itemNr&&initPortal?(initPortal=!1,$("#tickBox").css("background-position-x","3px"),localStorage_setItem("initPortal","off")):1!=itemNr||initPortal||(initPortal=!0,$("#tickBox").css("background-position-x","-34px"),localStorage_setItem("initPortal","on"))}function setCurrentTime(){var e=new Date;if(e.setHours(e.getHours()+DST),e.getMinutes()>=0&&e.getMinutes()<=9)var t="0"+e.getMinutes();else t=e.getMinutes();$("#currentTime, #hour_value").html(e.getHours()+":"+t)}function preloadSettings(){"off"==localStorage_getItem("initPortal")?(initPortal=!1,$("#tickBox").css("background-position-x","3px")):(initPortal=!0,$("#tickBox").css("background-position-x","-34px")),"original"==localStorage_getItem("zoomOption")?setZoomRadio("original"):"full"==localStorage_getItem("zoomOption")?setZoomRadio("full"):"zoom"==localStorage_getItem("zoomOption")?setZoomRadio("zoom"):setZoomRadio("original"),"group"==localStorage_getItem("groupScroll")?setGroupRadio("group"):"list"==localStorage_getItem("groupScroll")?setGroupRadio("list"):setGroupRadio("group"),"on"==localStorage_getItem("hlsMode")?setHLSRadio("hlsOn"):(localStorage_getItem("hlsMode"),setHLSRadio("hlsOff")),"native"==localStorage_getItem("webOSMode")?setWOSRadio("native"):"emu"==localStorage_getItem("webOSMode")?setWOSRadio("emu"):"auto"==localStorage_getItem("webOSMode")?setWOSRadio("auto"):-1!=tvModel.indexOf("webOS")?setWOSRadio("native"):setWOSRadio("auto"),"on"==localStorage_getItem("dvbMode")?setDVBRadio("on"):(localStorage_getItem("dvbMode"),setDVBRadio("off")),"lg"==localStorage_getItem("colorTheme")?(selectedThemecolor=0,setColorRadio("color_lg")):"android"==localStorage_getItem("colorTheme")?(selectedThemecolor=1,setColorRadio("color_android")):"yellow"==localStorage_getItem("colorTheme")?(selectedThemecolor=2,setColorRadio("color_yellow")):"green"==localStorage_getItem("colorTheme")?(selectedThemecolor=3,setColorRadio("color_green")):"violet"==localStorage_getItem("colorTheme")?(selectedThemecolor=4,setColorRadio("color_violet")):(selectedThemecolor=0,setColorRadio("color_lg")),$("#initPortal").click(function(e){initPortal?($("#tickBox").css("background-position-x","3px"),initPortal=!1,localStorage_setItem("initPortal","off")):($("#tickBox").css("background-position-x","-34px"),initPortal=!0,localStorage_setItem("initPortal","on"))}),$("#DST").click(function(e){DST?($("#tickBox2").css("background-position-x","3px"),DST=!1):($("#tickBox2").css("background-position-x","-34px"),DST=!0),setCurrentTime()}),$("#original").click(function(){setZoomRadio("original"),localStorage_setItem("zoomOption","original")}),$("#full").click(function(){setZoomRadio("full"),localStorage_setItem("zoomOption","full")}),$("#zoom").click(function(){setZoomRadio("zoom"),localStorage_setItem("zoomOption","zoom")}),$("#groupScroll").children().click(function(){var e=$(this).attr("id");setGroupRadio(e),localStorage_setItem("groupScroll",e)}),$("#hlsOn").click(function(){setHLSRadio("hlsOn"),localStorage_setItem("hlsMode","on")}),$("#hlsOff").click(function(){setHLSRadio("hlsOff"),localStorage_setItem("hlsMode","off")}),$("#native").click(function(){setWOSRadio("native"),localStorage_setItem("webOSMode","native")}),$("#emu").click(function(){setWOSRadio("emu"),localStorage_setItem("webOSMode","emu")}),$("#auto").click(function(){setWOSRadio("auto"),localStorage_setItem("webOSMode","auto")}),$("#dvbMode").children().click(function(){var e=$(this).attr("id");setDVBRadio(e),localStorage_setItem("dvbMode",e),"off"==e&&localStorage_removeItem("dvbData")})}function setZoomRadio(e){$("#zoomRadio .input").css("background-position-x","-78px"),$("#"+e).find(".input").css("background-position-x","-115px")}function setGroupRadio(e){$("#groupScroll .input").css("background-position-x","-78px"),$("#"+e).find(".input").css("background-position-x","-115px")}function setHLSRadio(e){$("#hlsMode .input").css("background-position-x","-78px"),$("#"+e).find(".input").css("background-position-x","-115px")}function setWOSRadio(e){$("#webOSMode .input").css("background-position-x","-78px"),$("#"+e).find(".input").css("background-position-x","-115px")}function setDVBRadio(e){$("#dvbMode .input").css("background-position-x","-78px"),$("#"+e).find(".input").css("background-position-x","-115px")}function setTimeRadio(e){$("#timeTune .rad").prop("checked",!1),$("#timeTune .rad").css("background-position-x","-78px");var t=$("#"+e);t.prop("checked",!0),t.css("background-position-x","-115px")}function setColorRadio(e){$("#colorTheme .rad").prop("checked",!1),$("#colorTheme .rad").css("background-position-x","-78px");var t=$("#"+e);t.prop("checked",!0),t.css("background-position-x","-115px")}