var ibarTimeout,videoJumpTimeout,videoInfoInterval,networkStateInterval,noteInterval,onTimeUpdateInterval,mouseOffTimeOut,tvModel=navigator.userAgent,ibarTimeoutActive=!1,videoJump=0,keyDelay=500,mouseOn=!1,mouseOnProgress=!1,soundNote=!1,infobarPermanent=!1,playIcon='<img class="playIcon" src="images/play.svg" alt=""/>',pauseIcon='<img src="images/pause.svg" alt=""/>',rewindIcon='<img src="images/rewind.svg" alt=""/>',fforwardIcon='<img src="images/fforward.svg" alt=""/>',videoDimensionSet=!1,audioWindow=!1,subsWindow=!1,audioSet=!1,audioIDSelected=0,audioPrevIDSelected=0,audioOKPressed=!1,audioInfoReady=!1,subsSet=!1,subsIDSelected=0,subsPrevIDSelected=0,subsOKPressed=!1,subsInfoReady=!1,bcastExecuted=!1,historyExecuted=!1;function loadingKeyEvents(){$(document).unbind("keydown keyup").keydown(function(e){switch(e.which){case VK_BACK:case VK_B:case VK_STOP:restoreMenu("playback")}})}function keyEvents(){var e=event.which;if(!(VK_0<e&&VK_9>=e))switch(e){case VK_PLAY:case VK_P:startMedia();break;case VK_PAUSE:case VK_A:case VK_SPACE:stopMedia();break;case VK_RIGHT:webOSNative?forwardMedia(30):forwardMediaNC(30);break;case VK_LEFT:webOSNative?rewindMedia(30):rewindMediaNC(30);break;case VK_UP:webOSNative?forwardMedia(60):forwardMediaNC(60);break;case VK_DOWN:webOSNative?rewindMedia(60):rewindMediaNC(60);break;case VK_FAST_FWD:case VK_F:webOSNative?forwardMedia(120):forwardMediaNC(120);break;case VK_REWIND:case VK_W:webOSNative?rewindMedia(120):rewindMediaNC(120);break;case VK_PAGE_UP:playNextVideo();break;case VK_PAGE_DOWN:playPreviousVideo();break;case VK_GREEN:infobarToggle(),setContinuousPlay();break;case VK_YELLOW:clockToggle();break;case VK_ENTER:case VK_INFO:case VK_I:infobarTogglePermanent();break;case VK_BLUE:case VK_L:localStorage_setItem("backPath","player"),window.location.replace("settings.html");break;case VK_RED:case VK_R:audioInfoReady&&chooseAudioLang();break;case VK_STOP:restoreMenu("playback");break;case VK_BACK:case VK_B:"block"!=$("#infobar").css("display")||mouseOn?restoreMenu("playback"):infobarHide()}}function fsAudioKeyEvents(){$(document).unbind("keydown keyup").keydown(function(){switch(event.keyCode){case VK_ENTER:setAudioLang();break;case VK_UP:selectAudioLang(-1);break;case VK_DOWN:selectAudioLang(1);break;case VK_RED:case VK_R:chooseAudioLang();break;case VK_GREEN:case VK_G:chooseSubsLang();break;case VK_BACK:case VK_B:chooseAudioLang()}})}function fsSubsKeyEvents(){$(document).unbind("keydown keyup").keydown(function(e){switch(e.keyCode){case VK_ENTER:setSubsLang();break;case VK_UP:selectSubsLang(-1);break;case VK_DOWN:selectSubsLang(1);break;case VK_RED:case VK_R:chooseAudioLang();break;case VK_GREEN:case VK_G:chooseSubsLang();break;case VK_BACK:case VK_B:chooseSubsLang()}})}function playerMouseEvents(){$("#videoContainer").mousemove(function(e){onMouseActive()}),$("#video").unbind("click").click(function(e){infobarTogglePermanent()}),$("#rewind").unbind("click").click(function(){playPreviousVideo()}),$("#play").unbind("click").click(function(){playMedia()}),$("#fforward").unbind("click").click(function(){playNextVideo()}),$("#playMode").unbind("click").click(function(){setContinuousPlay()}),$("#btn_qmenu").mouseover(function(){webOSNative?$(".pref_button").show():$(".settingsButton").show()}),$("#btn_qmenu").click(function(){localStorage_setItem("backPath","player"),window.location.replace("settings.html")}),$("#btn_back").click(function(){restoreMenu("playback")}),$("#btn_audio").click(function(){audioInfoReady&&chooseAudioLang()}),$("#audioToolPanel").click(function(){chooseSubsLang()}),$("#subsToolPanel").click(function(){audioInfoReady&&chooseAudioLang()}),$("#currentProgress").unbind("mouseenter mouseleave").hover(function(e){$("#progPointer").show(),$("#pointerTime").show(),onProgressMouseActive(),mouseOnProgress=!0},function(e){$("#progPointer").css("left",progFillPercentage+"%"),$("#pointerTime").hide(),$("#currentProgress").unbind("mousemove"),mouseOnProgress=!1}),$("#currentProgress").unbind("click").click(function(e){var o=$(this).offset();progMouseJump(e.pageX-o.left)})}function progPointerMove(e){$("#progPointer").css("left",e),e>0?($("#progPointer").show(),$("#progPointer").css("left",e)):$("#progPointer").css("left",progFillPercentage+"%")}function unbindPlayerMouseEvents(){$("#videoContainer").unbind("mousemove"),$("#controlBar").children().unbind("click")}function onMouseActive(){clearTimeout(mouseOffTimeOut),$(".loadingSpinner").is(":visible")||$(".errorMessage").is(":visible")||($("#infobar").show(),$(".button").show(),$("#bufferBubble").hide()),soundNote&&centerNote(),clearTimeout(ibarTimeout),infobarPermanent||(ibarTimeout=setTimeout("infobarHide(); ibarTimeoutActive = false;",4e3)),mouseOn=!0}function onMouseInactive(){$(".button").hide(),mouseOn=!1}function onProgressMouseActive(e){$("#currentProgress").mousemove(function(e){e.stopPropagation(),$("#pointerTime").is(":visible")||$("#pointerTime").show();var o=$(this).offset(),i=e.pageX-o.left;e.pageY,o.top,calcPointerDigits(i),progPointerMove(i)})}function calcPointerDigits(e){lengthRatio=video.duration/$("#currentProgress").width(),timePoint=e*lengthRatio,timePoint<0&&(timePoint=0),$("#pointerDigits").html(timeConvert(timePoint))}function playerBindEvents(){$("#video").bind("play",function(e){changeControlIcon(e.type),rebindKeys(),playerMouseEvents()}),$("#video").bind("pause",function(e){changeControlIcon(e.type)}),$("#video").bind("error",function(e){onVideoError()}),$("video").bind("loadstart emptied canplaythrough ratechange progress stalled playing durationchange resize suspend loadedmetadata timeupdate volumechange abort loadeddata canplay pause waiting play error",function(e){}),$("#video").bind("timeupdate",function(e){onTimeUpdate()}),$("#video").bind("loadstart",function(e){}),$("#video").bind("loadedmetadata",function(e){getVideoInfo()}),$("#video").bind("loadeddata",function(e){}),$("#video").bind("umsmediainfo",function(e){handleUMSMediaInfo(e.detail)}),$("#video").bind("playing",function(e){getAudioLang(),getSubsLang()}),$("#video").bind("seeking",function(e){clearTimeout(ibarTimeout)}),$("#video").bind("seeked",function(e){infobarToggle(),$("#pointerTime").hide(),$("#progPointer").css("left",progFillPercentage+"%")}),$("#video").bind("ended",function(e){removeVideoCue(),video.duration>5?restoreMenu():setTimeout(restoreMenu,5e3)})}function handleUMSMediaInfo(e){var o=JSON.parse(e);if("sourceInfo"==o.type){o.info.numPrograms>0&&(videoInfo=o.info.programInfo[0],numAudioTracks=videoInfo.numAudioTracks,numVideoTracks=videoInfo.numVideoTracks,numTextTracks=videoInfo.numSubtitleTracks),audioCode="",audioTrackSet=!1,audioCount=0,audioLangID=[],audioLangNameArray=[],audioCodecNameArray=[],subsCount=0,subsLangID=[],subsLangNameArray=[],videoCount=0,videoTrackResolution=[],videoTrackFramerate=[];for(var i=0,t=0,n=0;n<numVideoTracks;n++)videoInfo.videoTrackInfo[n].frameRate&&(videoTrackFramerate[0]="x"+videoInfo.videoTrackInfo[n].frameRate);for(var a=0;a<numAudioTracks;a++)audioCount++,"mpeg"!=videoInfo.audioTrackInfo[a].codec?(audioLangNameArray[i]=videoInfo.audioTrackInfo[a].language,audioCodecNameArray[i]=videoInfo.audioTrackInfo[a].codec):(audioLangNameArray[i]=videoInfo.audioTrackInfo[a].language,audioCodecNameArray[i]=""),audioLangID[i]=a,i++,urlUDP&&videoInfo.audioTrackInfo[a].language==urlUDP&&(audioCode=a);audioInfoReady=!0;for(var r=0;r<numTextTracks;r++)subsCount++,subsLangNameArray[t]=videoInfo.subtitleTrackInfo[r].language,subsLangID[t]=r,t++;$("#rightStatus #audioCount").html("A: "+audioCount),$("#rightStatus #subsCount").html("S: "+subsCount),subsCount>0&&(subsCount++,subsLangNameArray.push("Subs Off"),subsLangID.push(subsCount)),subsIDSelected=subsCount-1,subsPrevIDSelected=subsIDSelected}}function playStateChangeFunction(){switch(video.playState){case 1:getVideoInfoNC();break;case 4:onBufferingProgress();break;case 5:onVideoFinished();break;case 6:onVideoError()}}function onTimeUpdate(){timeUpdated=!0}function removeVideoCue(){video.duration?videoDuration=video.duration:videoDuration=0,localStorage_setItem(chDataSelected.chUrl,'{"title":"'+encodeURIComponent(vData.title)+'","saved":0,"total":'+videoDuration+"}")}function checkProgressState(){video.currentTime>prevTime&&timeUpdated?ibarTimeoutActive||($("#bufferBubble, #leftStatus").hide(),clearTimeout(ibarTimeout),infobarPermanent||(ibarTimeout=setTimeout(infobarHide,4e3),ibarTimeoutActive=!0)):(clearTimeout(ibarTimeout),video.duration>video.currentTime&&($("#infobar").is(":visible")?$("#leftStatus").show():$("#bufferBubble").show()),timeUpdated=!1,ibarTimeoutActive=!1),prevTime=video.currentTime}function checkNetworkState(){isNaN(video.duration)?(errorRetryCount++,errorRetryCount>4&&onVideoError()):clearInterval(networkStateInterval)}function onVideoError(){clearInterval(networkStateInterval),$(".loadingSpinner").hide(),urlFailMessage?($("#videoContainer").append('<div class="errorMessage"><p>'+urlFailMessage+"</p></div>"),urlFailMessage=""):$("#videoContainer").append(errBadVideoFormat),setTimeout('restoreMenu("playback");',2500)}function consoleLog(e){$("#videoContainer").append(errBadVideoFormat),$(".errorMessage").html(e)}function getVideoInfo(){timeUpdated=!0,$(".loadingSpinner").hide(),-1===video.currentSrc.indexOf(".mp3")&&-1===video.currentSrc.indexOf(".wav")&&-1===video.currentSrc.indexOf(".aac")||(soundNote=!0,$("#soundNote").fadeIn(1500)),$("#duration span").html(Math.round(video.duration)),0==video.videoWidth||0==video.videoHeight||null==video.videoWidth||null==video.videoHeight||videoDimensionSet||($("#infobar").append('<div id="videoDimension">'+video.videoWidth+"x"+video.videoHeight+"</div>"),videoDimensionSet=!0),localStorage_getItem(chDataSelected.chUrl)&&(videoData=JSON.parse(localStorage_getItem(chDataSelected.chUrl)),"object"!=typeof videoData?video.currentTime=videoData:video.currentTime=videoData.saved),infobarToggle()}function getVideoInfoNC(){if(urlUDP&&changeLanguage(),timeUpdated=!0,$(".loadingSpinner").hide(),$("#bufferBubble, #leftStatus").hide(),-1===video.data.indexOf(".mp3")&&-1===video.data.indexOf(".wav")&&-1===video.data.indexOf(".aac")||(soundNote=!0,$("#soundNote").fadeIn(1500)),$("#duration span").html(Math.round(video.playTime)),0==video.width||0==video.height||null==video.width||null==video.height||videoDimensionSet||($("#infobar").append('<div id="videoDimension">'+video.width+"x"+video.height+"</div>"),videoDimensionSet=!0),localStorage_getItem(chDataSelected.chUrl))try{videoData=JSON.parse(localStorage_getItem(chDataSelected.chUrl)),"object"!=typeof videoData?videoData>video.playPosition&&video.seek(1e3*videoData):videoData.saved>video.playPosition&&video.seek(1e3*videoData.saved)}catch(e){console.log(e)}infobarToggle(),changeControlIcon("play"),rebindKeys(),playerMouseEvents()}function changeLanguage(){video.audioLanguage=urlUDP}function timeConvert(e){e=Number(e);var o=Math.floor(e/3600),i=Math.floor(e%3600/60),t=Math.floor(e%3600%60);return(o>0?o+":":"")+(i>0?(o>0&&i<10?"0":"")+i+":":"0:")+(t<10?"0":"")+t}function setVideoProgress(){video.duration?videoDuration=video.duration:videoDuration=0,localStorage_setItem(chDataSelected.chUrl,'{"title":"'+encodeURIComponent(vData.title)+'","saved":'+video.currentTime+',"total":'+videoDuration+"}"),$("#currentTime span").html(timeConvert(Math.round(video.currentTime))),$("#leftTime span").html(timeConvert(Math.round(video.duration-video.currentTime))),progFillPercentage=Math.round(video.currentTime/video.duration*100),$("#progRunner").css("width",progFillPercentage+"%"),$("#progRunner").width()>=$("#progPointer").position().left&&!mouseOnProgress&&$("#progPointer").css("left",progFillPercentage+"%"),video.buffered.length>0?$("#progBuffer").css("width",Math.round(video.buffered.end(0)/video.duration*100)+"%"):$("#progBuffer").css("width",0)}function setVideoProgressNC(){video.playTime?videoDuration=video.playTime:videoDuration=0,localStorage_setItem(chDataSelected.chUrl,'{"title":"'+encodeURIComponent(vData.title)+'","saved":'+video.playPosition/1e3+',"total":'+videoDuration/1e3+"}"),$("#currentTime span").html(timeConvert(Math.round(video.playPosition/1e3))),$("#leftTime span").html(timeConvert(Math.round((video.playTime-video.playPosition)/1e3))),progFillPercentage=Math.round(video.playPosition/video.playTime*100),$("#progRunner").css("width",progFillPercentage+"%"),$("#progRunner").width()>=$("#progPointer").position().left&&!mouseOnProgress&&$("#progPointer").css("left",progFillPercentage+"%")}function onBufferingProgress(){$(".loadingSpinner").is(":visible")||$(".errorMessage").is(":visible")||$("#infobar").is(":visible")?$("#leftStatus").show():video.playPosition>0&&$("#bufferBubble").show(),clearTimeout(ibarTimeout)}function onVideoFinished(){removeVideoCue(),video.playTime>5e3?restoreMenu():setTimeout(restoreMenu,5e3)}function progMouseJump(e){webOSNative?lengthRatio=video.duration/$("#currentProgress").width():lengthRatio=video.playTime/$("#currentProgress").width();var o=e*lengthRatio;webOSNative?video.currentTime=o:(video.seek(o),2==video.playState&&playMedia())}function clearVideoInfo(){clearInterval(videoInfoInterval),clearInterval(networkStateInterval),clearInterval(onTimeUpdateInterval),clearInterval(moveRandom),$("#video").unbind(),$("#duration span").html(""),$("#currentTime span").html(""),$("#leftTime span").html(""),$("#bufferTime span").html(""),$("#progRunner").css("width",0),$("#progBuffer").css("width",0),$("#progPointer").css("left",0),$("#pointerDigits").html("0:00"),$("#pointerTime").hide(),$("#leftStatus").hide(),$("#bufferBubble").hide(),$("#soundNote").hide(),mouseOnProgress=!1,soundNote=!1,infobarPermanent=!1,restoreMenu("playback")}function changeControlIcon(e){switch(e){case"play":$("#play").html(pauseIcon);break;case"pause":$("#play").html(playIcon)}}function startMedia(){webOSNative?(0==video.readyState&&video.play(),4!=video.readyState&&3!=video.readyState||video.paused&&video.play()):2==video.playState&&(video.play(1),changeControlIcon("play")),infobarToggle()}function stopMedia(){webOSNative?4!=video.readyState&&3!=video.readyState||video.paused||video.pause():2!=video.playState&&(video.play(0),changeControlIcon("pause")),infobarToggle()}function playMedia(){webOSNative?(0==video.readyState&&video.play(),4!=video.readyState&&3!=video.readyState||(video.paused?video.play():video.pause())):2!=video.playState?(video.play(0),changeControlIcon("pause")):(video.play(1),changeControlIcon("play")),infobarToggle()}function forwardMedia(e){if(infobarToggle(),videoJump<0&&(videoJump=0),videoJump+=e,$("#pointerTime").show(),video.currentTime+videoJump<=video.duration){var o=Math.round((video.currentTime+videoJump)/video.duration*100);o>100&&(o=100),$("#progPointer").css("left",o+"%"),$("#pointerDigits").html(timeConvert(video.currentTime+videoJump+1))}else $("#progPointer").css("left","100%");videoJumpTimeout&&clearTimeout(videoJumpTimeout),videoJumpTimeout=setTimeout(function(){video.currentTime<video.duration&&(video.currentTime+=videoJump,videoJump=0)},keyDelay),video.paused&&playMedia()}function rewindMedia(e){if(infobarToggle(),videoJump>0&&(videoJump=0),videoJump-=e,$("#pointerTime").show(),video.currentTime+videoJump>=0){var o=Math.round((video.currentTime+videoJump)/video.duration*100);o<0&&(o=0),$("#progPointer").css("left",o+"%"),$("#pointerDigits").html(timeConvert(video.currentTime+videoJump+1))}else $("#pointerDigits").html("0:00"),$("#pointerTime").hide(),$("#progPointer").css("left",0);videoJumpTimeout&&clearTimeout(videoJumpTimeout),videoJumpTimeout=setTimeout(function(){video.currentTime<video.duration&&(video.currentTime+=videoJump,videoJump=0)},keyDelay),video.paused&&playMedia()}function forwardMediaNC(e){if(infobarToggle(),videoJump<0&&(videoJump=0),videoJump+=e,$("#pointerTime").show(),video.playPosition/1e3+videoJump<=video.playTime/1e3){var o=Math.round((video.playPosition/1e3+videoJump)/(video.playTime/1e3)*100);o>100&&(o=100),$("#progPointer").css("left",o+"%"),$("#pointerDigits").html(timeConvert(video.playPosition/1e3+videoJump+1))}else $("#progPointer").css("left","100%");videoJumpTimeout&&clearTimeout(videoJumpTimeout),videoJumpTimeout=setTimeout(function(){video.playPosition+1e3*videoJump<video.playTime?(video.seek(video.playPosition+1e3*videoJump),videoJump=0,infobarToggle(),$("#pointerTime").hide(),$("#progPointer").css("left",progFillPercentage+"%"),2==video.playState&&playMedia()):video.seek(video.playTime)},keyDelay)}function rewindMediaNC(e){if(infobarToggle(),videoJump>0&&(videoJump=0),videoJump-=e,$("#pointerTime").show(),video.playPosition/1e3+videoJump>=0){var o=Math.round((video.playPosition/1e3+videoJump)/(video.playTime/1e3)*100);o<0&&(o=0),$("#progPointer").css("left",o+"%"),$("#pointerDigits").html(timeConvert(video.playPosition/1e3+videoJump+1))}else $("#pointerDigits").html("0:00"),$("#pointerTime").hide(),$("#progPointer").css("left",0);videoJumpTimeout&&clearTimeout(videoJumpTimeout),videoJumpTimeout=setTimeout(function(){video.playPosition+1e3*videoJump>0?(video.seek(video.playPosition+1e3*videoJump),videoJump=0,infobarToggle(),$("#pointerTime").hide(),$("#progPointer").css("left",progFillPercentage+"%"),2==video.playState&&playMedia()):video.seek(0)},keyDelay)}function infobarShow(){soundNote&&centerNote(),clearTimeout(ibarTimeout),webOSNative?setVideoProgress():setVideoProgressNC(),$("#infobar").show(),$("#bufferBubble").hide()}function infobarHide(){soundNote&&(clearInterval(noteInterval),noteInterval=setInterval(moveRandom,3e3)),$("#infobar").hide(),$(".button, .pref_button").hide(),$("#videoDimension").hide()}function infobarToggle(){webOSNative?setVideoProgress():setVideoProgressNC(),clearTimeout(ibarTimeout),clearInterval(videoInfoInterval),clearInterval(onTimeUpdateInterval),$("#infobar").show(),$("#bufferBubble").hide(),soundNote&&centerNote(),videoInfoInterval=webOSNative?setInterval(setVideoProgress,1e3):setInterval(setVideoProgressNC,1e3),webOSNative&&(video.paused||(onTimeUpdateInterval=setInterval(checkProgressState,250))),infobarPermanent||(ibarTimeout=setTimeout("infobarHide(); ibarTimeoutActive = false;",4e3))}function infobarTogglePermanent(){soundNote&&centerNote(),clearTimeout(ibarTimeout),$("#infobar").toggle(),$("#infobar").is(":visible")?($("#bufferBubble").hide(),soundNote&&(infobarPermanent=!0)):($(".button, .pref_button").hide(),soundNote&&(noteInterval=setInterval(moveRandom,3e3)),infobarPermanent=!1),$("#videoDimension").hide()}function centerNote(){clearInterval(noteInterval),$(".noteSprite").css("top",0).css("bottom",130).css("left",0).css("right",0).css("margin","auto")}function randomFromTo(e,o){return Math.floor(Math.random()*(o-e+1)+e)}function moveRandom(){obj=$(".noteSprite");var e=$("#soundNote").offset(),o=$("#soundNote").height(),i=$("#soundNote").width(),t=parseInt($("#soundNote").css("padding-top").replace("px","")),n=obj.height(),a=obj.width();maxY=e.top+o-n-t,maxX=e.left+i-a-t,minY=e.top+t,minX=e.left+t,newY=randomFromTo(minY,maxY),newX=randomFromTo(minX,maxX),obj.css("top",newY).css("left",newX).css("margin",0)}function setCurrentTime(){if(currentDate=new Date,currentDate.setHours(currentDate.getHours()+DST),currentDate.getMinutes()>=0&&currentDate.getMinutes()<=9)var e="0"+currentDate.getMinutes();else e=currentDate.getMinutes();$("#fsClock").html(currentDate.getHours()+":"+e)}