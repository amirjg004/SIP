var subsCode,subsCount=0,subsLangID=[],subsOn=!1;function chooseSubsLang(){if(!bcastExecuted){if(subsWindow=!subsWindow,!subsWindow)return $("#subsSelect").hide(),void rebindKeys();$("#subsSelect").show(),$(".subsLang").remove(),subsCount>0?(historyExecuted&&historyDeactivate(),chooseAudioLangDeactivate(),showSubsLangs()):(chooseAudioLangDeactivate(),$("#subsSelect #subsText").append('<div id="nosubs" class="subsLang">No subs</div>'),subsSet=!subsSet),fsSubsKeyEvents()}}function showSubsLangs(){subsLangList="";for(var s=0;s<subsCount;s++)s==subsCount-1?subsLangName=subsLangNameArray[s]:subsLangNameArray[s]&&"(null)"!=subsLangNameArray[s]?subsLangName=subsLangNameArray[s].toUpperCase():subsLangName="Subtitles "+(s+1),s==subsIDSelected&&subsCount>=1?subsSelected=" selected":subsSelected="",0==subsCount&&(subsSet=!subsSet),$("#subsSelect  #subsText").append('<div id="subs-'+s+'" class="subsLang'+subsSelected+'" style="top: '+38*s+'px">'+subsLangName+"</div>");checkSubsSelectedPosition(),fsSubsMouseEvents()}function checkSubsSelectedPosition(){var s=parseInt($("#subs-"+subsIDSelected).css("top"),10)+trackLineHeight;s>=maxTrackWindowHeight?$("#subsText").css("top",-1*(s-maxTrackWindowHeight)):s==trackLineHeight&&$("#subsText").css("top",0)}function selectSubsLang(s){subsOKPressed&&(subsSet=!1),$("#subs-"+subsIDSelected).removeClass("selected"),subsIDSelected+=s,subsIDSelected<0&&(subsIDSelected=subsCount-1),subsIDSelected>subsCount-1&&(subsIDSelected=0),checkSubsSelectedPosition(),$("#subs-"+subsIDSelected).addClass("selected")}function setSubsLang(s){if(subsSet||subsPrevIDSelected==subsIDSelected)chooseSubsLangDeactivate();else try{subsIDSelected==subsCount&&clearSubsCookie(),webOS.service.request("luna://com.webos.media",{method:"selectTrack",parameters:{type:"text",index:subsLangID[subsIDSelected],mediaId:video.mediaId},onSuccess:function(s){},onFailure:function(s){}}),subsPrevIDSelected=subsIDSelected,subsOKPressed=!0,subsSet=!1,subsCode=subsLangID[subsIDSelected],subsIDSelected!=subsCount&&setSubsCookie(),"mouse"==s&&chooseSubsLangDeactivate()}catch(s){console.log(s)}}function chooseSubsLangDeactivate(){$("#subsSelect").hide(),subsWindow=!1,rebindKeys(),subsOKPressed=!1,subsSet=!1}function setSubsCookie(){"ext"==chNr||"avi"==chNr?subsChNr=chPos:subsChNr=chNr,localStorage_setItem("subs-"+subsChNr,subsCode)}function clearSubsCookie(){"ext"==chNr||"avi"==chNr?subsChNr=chPos:subsChNr=chNr,localStorage_removeItem("subs-"+subsChNr)}function fsSubsMouseEvents(){$("[id*='subs-']").hover(function(){$("[id*='subs-']").removeClass("selected"),$(this).addClass("selected")},function(){$(this).removeClass("selected")}),$("[id*='subs-']").click(function(){subsIDSelected=$(this).attr("id"),subsIDSelected=subsIDSelected.replace("subs-",""),setSubsLang("mouse")})}function getSubsLang(){if("ext"==chNr||"avi"==chNr?subsChNr=chPos:subsChNr=chNr,localStorage_getItem("subs-"+subsChNr)&&(subsCode=localStorage_getItem("subs-"+subsChNr)),subsCode){for(var s=0;s<subsCount;s++)if(subsLangID[s]==subsCode)try{webOS.service.request("luna://com.webos.media",{method:"selectTrack",parameters:{type:"text",index:subsLangID[s],mediaId:video.mediaId},onSuccess:function(s){},onFailure:function(s){}}),subsIDSelected=s,subsPrevIDSelected=s;break}catch(s){console.log(s)}}else webOS.service.request("luna://com.webos.media",{method:"selectTrack",parameters:{type:"text",index:subsCount-1,mediaId:video.mediaId},onSuccess:function(s){},onFailure:function(s){}}),subsIDSelected=subsCount-1,subsPrevIDSelected=subsCount-1}