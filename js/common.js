var longClickTimeout,multiPressTimeout,longPressTimeout,appVersion="3.0.3",vkApiVersion="5.95",eventHandlerArray=[],regKeyTimeout=250,keyPressDown=!1,multiPress=!1,longPress=!1,longMouseClick=!1,multiPressDelay=250,longPressDelay=600,parAttempts=0,maxParAttempts=3,ajaxTimeout=3e3,epgTimeout=5e3,ajaxCache=!0;function localStorage_setItem(e,a){localStorage.removeItem(e);try{localStorage.setItem(e,a)}catch(e){console.error("Out of localStorage memory!"),sessionStorage.setItem("oom","1")}}function localStorage_getItem(e){return localStorage.getItem(e)}function localStorage_removeItem(e){localStorage.removeItem(e)}localStorage_getItem("sampleRate")?sampleRate=localStorage_getItem("sampleRate"):sampleRate=100;var plistRefreshArray=["Auto","Manual","1 h","3 h","6 h","12 h","24 h","72 h","168 h"],defaultPlistRefresh=plistRefreshArray.length-3,plistRefresh=defaultPlistRefresh;function getPlistRefresh(){plistRefresh=localStorage_getItem("plistRefresh")&&!isNaN(localStorage_getItem("plistRefresh"))?Number(localStorage_getItem("plistRefresh")):defaultPlistRefresh}function rebindKeys(){longPress=!1,$(document).off("keydown keyup").on("keydown keyup",function(e){"keydown"==e.type?(keyPressDown||(longPressTimeout=setTimeout(function(){longPress=!0,keyEventsLong(e)},longPressDelay)),keyPressDown=!0,keyEvents()):(clearTimeout(longPressTimeout),keyPressDown=!1,longPress||keyEventsUp(),longPress=!1)})}function keyEventsUp(){}function keyEventsLong(e){}function reloadApp(){sessionStorage.setItem("plistUpdate","1"),window.location="index.html"}function getToChannels(){window.location.replace("channels.html")}function getToFullscreen(){window.location.replace("fullscreen.html")}function getToVideoPlayer(){window.location.replace("player.html")}function getToArcPlay(){window.location.replace("arc_play.html")}function getToSettings(){window.location.replace("settings.html")}function getToArchive(){"avi"!=chData[chanSelected].chNr&&"ext"!=chData[chanSelected].chNr&&(localStorage_setItem(menuChannelCookie,chanSelected),sessionStorage.setItem("arcChannelData",JSON.stringify(chData[chanSelected])),window.location.replace("archive.html?chan="+chanSelected+"&day=0&pg=1"))}function showToast(e){$("#toastText").html(e),$("#toast").stop(!0).fadeIn(400).delay(500).fadeOut(400)}function clockToggle(){clockOn?($("#fsClock").hide(),clockOn=!1,localStorage_setItem("fsClock","off")):($("#fsClock").show(),clockOn=!0,localStorage_setItem("fsClock","on"))}function getToEPG(){window.location.replace("epg.html?chan="+arcChan)}function backToHome(){webOS.platformBack()}function trim(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function isThisLGEBrowser(){var e=new String(navigator.userAgent);return null!=e&&e.search(/LG Browser/)>-1}function getLGEBrowserVersion(){if(!isThisLGEBrowser())return"-1";var e=new String(navigator.userAgent);return e.substring(e.search(/LG Browser/)+11).split("(",1)}function addDVBChList(){webOS.service.request("luna://com.palm.db",{method:"search",parameters:{query:{from:"com.webos.service.tv.channel.dblist:1",filter:[{prop:"Invisible",op:"=",val:!1},{prop:"skipped",op:"=",val:!1}]}},onComplete:function(e){var a=e.count,t=e.results;if(0!=a){var n=[],o=[],c=[],r=[],l=[],h=[],s=[];0==chData[0]&&(chData[0]=[],chData[0][0]={name:"All channels",pos:0}),chanGroups=chData[0];var i=[],u=chData[0].length;chanGroups[u]={},chanGroups[u].name="DVB Channels",chanGroups[u].pos=chData.length-1,iptvChannelCount=chData.length-1,channelCountGlobal=chData.length-1+t.length,localStorage_setItem("chCount",channelCountGlobal);for(var p=0;p<t.length;p++)t[p].channelId&&(n[p]=t[p].channelId,chData[chData.length]={},-1==tvModel.indexOf("webOS")?o[p]=decode_utf8(t[p].channelName):o[p]=t[p].channelName,o[p].trim()||(o[p]="No name"),c[p]=t[p].channelTypeId,r[p]=t[p].physicalNumber,1==t[p].DTV?s[p]=t[p].Handle+1:(l[p]=t[p].majorNumber,h[p]=t[p].minorNumber),i[p]={},i[p].pos=chData[chData.length-1].pos=chData.length-1,i[p].chNr=chData[chData.length-1].chNr="dvb",i[p].chId=chData[chData.length-1].chId=n[p],i[p].chName=chData[chData.length-1].chName=o[p],i[p].chUrl=chData[chData.length-1].chUrl="tv://"+n[p],1==c[p]?i[p].dvbNr=chData[chData.length-1].dvbNr="dvbt-"+s[p]:2==c[p]?i[p].dvbNr=chData[chData.length-1].dvbNr="dvba-"+s[p]:3==c[p]?i[p].dvbNr=chData[chData.length-1].dvbNr="dvbc-"+s[p]:6==c[p]||7==c[p]?i[p].dvbNr=chData[chData.length-1].dvbNr="dvbs-"+s[p]:i[p].dvbNr=chData[chData.length-1].dvbNr="dvb-"+s[p],chData[chData.length-1].gr=chanGroups[u].name,chData[chData.length-1].pos=chData.length-1);bcChannelsLoaded=!0,channelFinalize(),bcChannelList=i,localStorage_setItem("dvbData",JSON.stringify(i))}},onFailure:function(e){console.log("Failed to search"),console.log("["+e.errorCode+"]: "+e.errorText)}})}function addDVBChListStored(){if(localStorage_getItem("dvbData")){var e=JSON.parse(localStorage_getItem("dvbData"));bcChannelList=e,0==chData[0]&&(chData[0]=[],chData[0][0]={name:"All channels",pos:0}),chanGroups=chData[0];var a=chData[0].length;chanGroups[a]={},chanGroups[a].name="DVB Channels",chanGroups[a].pos=chData.length-1,iptvChannelCount=chData.length-1,channelCountGlobal=chData.length-1+e.length,localStorage_setItem("chCount",channelCountGlobal);for(var t=0;t<e.length;t++)chData[chData.length]={},chData[chData.length-1].gr=chanGroups[a].name,chData[chData.length-1].pos=e[t].pos,chData[chData.length-1].chNr=e[t].chNr,chData[chData.length-1].chName=e[t].chName,chData[chData.length-1].chUrl=e[t].chUrl,chData[chData.length-1].chId=e[t].chId,chData[chData.length-1].dvbNr=e[t].dvbNr,chData[chData.length-1].pos=chData.length-1;bcChannelsLoaded=!0,channelFinalize()}else channelFinalize()}function decode_utf8(e){for(var a=[],t=0;t<e.length;++t)charCode=e.charCodeAt(t),charCode>160&&173!=charCode&&240!=charCode&&253!=charCode?character=charCodes[charCode]:character=String.fromCharCode(charCode),a.push(character);return a.join("")}function bin2String(e){return String.fromCharCode.apply(String,e)}!function(e){e.fn.textWidth=function(){var a=e(this).html(),t="<span>"+a+"</span>";e(this).html(t);var n=e(this).find("span:first").width();return e(this).html(a),n}}(jQuery);var charCodes={160:" ",161:"�",162:"�",163:"�",164:"�",165:"�",166:"�",167:"�",168:"�",169:"�",170:"�",171:"�",172:"�",173:"SHY",174:"�",175:"�",176:"�",177:"�",178:"�",179:"�",180:"�",181:"�",182:"�",183:"�",184:"�",185:"�",186:"�",187:"�",188:"�",189:"�",190:"�",191:"�",192:"�",193:"�",194:"�",195:"�",196:"�",197:"�",198:"�",199:"�",200:"�",201:"�",202:"�",203:"�",204:"�",205:"�",206:"�",207:"�",208:"�",209:"�",210:"�",211:"�",212:"�",213:"�",214:"�",215:"�",216:"�",217:"�",218:"�",219:"�",220:"�",221:"�",222:"�",223:"�",224:"�",225:"�",226:"�",227:"�",228:"�",229:"�",230:"�",231:"�",232:"�",233:"�",234:"�",235:"�",236:"�",237:"�",238:"�",239:"�",240:"�",241:"�",242:"�",243:"�",244:"�",245:"�",246:"�",247:"�",248:"�",249:"�",250:"�",251:"�",252:"�",253:"�",254:"�",255:"�"};function setArcDate(){Math.floor((new Date).getTime()/1e3);var e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate());arcJump=a/1e3+24*dayNr*60*60;var t=new Date;t.setDate(t.getDate()+dayNr),yy=t.getFullYear(),dd=t.getDate(),mm=t.getMonth()+1;var n=t.toString().split(" ")[0];dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm);var o=n+" "+mm+"/"+dd;$("#arcDate").html(o).show()}function setTimer(e){allTimersArray[chanSelected]||(allTimersArray[chanSelected]=[]),-1==allTimersArray[chanSelected].indexOf(progEPG.start[arcChanSelected-1])&&progEPG.start[arcChanSelected-1]>parseInt(currentDate.getTime()/1e3)-3600*DST?(allTimersArray[chanSelected].push(progEPG.start[arcChanSelected-1]),localStorage_setItem("allTimers",JSON.stringify(allTimersArray)),$("#"+arcChanSelected+"_arcObjName .fs_eachTimerItem").length||$("#"+arcChanSelected+"_arcObjName").append('<span class="fs_eachTimerItem">&bull;</span>'),e?$("#fsTimerButton span").html("Remove Timer"):arcChanSelector(1)):-1!=allTimersArray[chanSelected].indexOf(progEPG.start[arcChanSelected-1])&&($("#"+arcChanSelected+"_arcObjName  .fs_eachTimerItem").remove(),allTimersArray[chanSelected].splice(allTimersArray[chanSelected].indexOf(progEPG.start[arcChanSelected-1]),1),0==allTimersArray[chanSelected].length&&delete allTimersArray[chanSelected],localStorage_setItem("allTimers",JSON.stringify(allTimersArray)),e?$("#fsTimerButton span").html("Set Timer"):arcChanSelector(1))}function getFavourites(){localStorage_getItem("favList")&&(favList=JSON.parse(localStorage_getItem("favList")))}function preloadFavourites(){if(0!=favList.length){0==chData[0]?(chData[0]=[],chData[0][0]={name:"Channels",pos:0},chData[0][1]={name:"Favourites",pos:chData.length-1,new:!0}):chData[0][chData[0].length]={name:"Favourites",pos:chData.length-1,new:!0};for(var e=0;e<favList.length;e++)chData[favList[e]]&&"object"!=typeof favList[e]?(chData[chData.length]={gr:"Favourites",pos:chData.length,favPos:e+1,chNr:chData[favList[e]].chNr,chName:chData[favList[e]].chName,chUrl:chData[favList[e]].chUrl},chData[favList[e]].par&&(chData[chData.length-1].par=chData[favList[e]].par)):favList[e]&&"object"==typeof favList[e]&&(favList[e].pos=chData.length,favList[e].favPos=e+1,chData[chData.length]=favList[e]);recalcChannelData()}}function recalcChannelData(){channelCountGlobal=chData.length-1,chanGroups=chData[0]}function getActiveGroup(){localStorage_getItem("currentGroup")&&"All"!=localStorage_getItem("currentGroup")?activeGroup=Number(localStorage_getItem("currentGroup")):activeGroup="All",groupCount=chData[0].length}function groupJumpCheck(e){if(chanSelected>channelCount)if("All"!=activeGroup&&0!=chanGroups){if("Favourites"==activeGroup)chanSelected=channelCountGlobal;else for(var a=1;a<chanGroups.length;a++){if(chanSelected<=chData[0][a].pos){activeGroup=chData[0][a-1].name,activeGroupStart=chData[0][a-1].pos,groupNr=a-1,channelCount=chData[0][a].pos;break}chanSelected<=channelCountGlobal?(activeGroup=chData[0][a].name,activeGroupStart=chData[0][a].pos,groupNr=a,channelCount=channelCountGlobal):chanGroups.length>0&&chanGroups[chanGroups.length-1].new&&!e?(chanSelected=chanGroups[chanGroups.length-1].pos,activeGroup=chanGroups[chanGroups.length-1].name):chanSelected=channelCountGlobal}localStorage_setItem(menuGroupCookie,groupNr)}else chanGroups.length>0&&chanGroups[chanGroups.length-1].new?chanSelected=chanGroups[chanGroups.length-1].pos:chanSelected=channelCountGlobal;else if(chanSelected<=activeGroupStart){if("Favourites"!=activeGroup||e){for(a=1;a<chanGroups.length;a++)if(chanSelected<=chData[0][a].pos){activeGroup=chData[0][a-1].name,activeGroupStart=chData[0][a-1].pos,groupNr=a-1,channelCount=chData[0][a].pos;break}}else activeGroupStart=chData[0][chData[0].length-1].pos,groupNr=chData[0].length-1,channelCount=channelCountGlobal,0==chanSelected?chanSelected=activeGroupStart+1:chanSelected=activeGroupStart+chanSelected,chanSelected>channelCount&&(chanSelected=channelCount);0==chanSelected&&(chanSelected=1),localStorage_setItem(menuGroupCookie,groupNr)}else chData[chanSelected].favPos&&(activeGroup=chanGroups[chanGroups.length-1].name,groupNr=chanGroups.length-1)}function calcGroupDimensions(){-1==groupNr?(activeGroup="All",activeGroupStart=0,chanGroups.length>0&&chanGroups[chanGroups.length-1].new?activeGroupEnd=chanGroups[chanGroups.length-1].pos:activeGroupEnd=channelCount):(activeGroup=chData[0][groupNr].name,activeGroupStart=chData[0][groupNr].pos,0==groupNr&&chanGroups.length>1?(activeGroupLength=chData[0][groupNr+1].pos,activeGroupEnd=chData[0][groupNr+1].pos):0==groupNr&&1==chanGroups.length?(activeGroupLength=channelCount,activeGroupEnd=channelCount):groupNr==chanGroups.length-1?(activeGroupLength=chData.length-chData[0][groupNr].pos-1,activeGroupEnd=chData.length-1):(activeGroupLength=chData[0][groupNr+1].pos-chData[0][groupNr].pos,activeGroupEnd=chData[0][groupNr+1].pos),channelCount=activeGroupStart+activeGroupLength)}favList=[];var hidden,visibilityChange,sortSet=!1;function resetOriginalChData(){chData.sort(function(e,a){return e.origPos-a.origPos}),j=0;for(var e=1;e<chData.length;e++)chData[e].pos=e,"favPos"in chData[e]&&(chData[e].favPos=j+1,j++)}function setYellowButtonText(){0==chSortType?$("#btn_all span, #fsYellowButton span").html("A-Z"):1==chSortType?$("#btn_all span, #fsYellowButton span").html("Z-A"):2==chSortType&&$("#btn_all span, #fsYellowButton span").html("Unsort")}function sortChannels(){if(0==chSortType||chData.length<=2)localStorage_getItem("chSortType")?$("#btn_all span, #fsYellowButton span").html("A-Z"):$("#btn_all span, #fsYellowButton span").html("Sort");else{if(!sortSet){for(var e=1;e<chData.length;e++)chData[e].origPos=chData[e].pos;sortSet=!0}if(chSortType>2&&(chSortType=0),localStorage_setItem("chSortType",chSortType),resetOriginalChData(),0!=chSortType){1==chSortType?$("#btn_all span, #fsYellowButton span").html("Z-A"):2==chSortType&&$("#btn_all span, #fsYellowButton span").html("Unsort");var a,t=0,n=0,o=[],c=[],r=[];for(o[0]=[],c[0]={},e=1;e<chData.length;e++)a="","All"!=activeGroup&&groupCount>0?chData[e].pos-1==chData[0][t].pos&&(t<chData[0].length-1&&t++,o[++n]=[],c[n]={}):n=0,-1==o[n].indexOf(chData[e].chName)?(o[n].push(chData[e].chName),c[n][chData[e].chName]=chData[e]):(a=chData[e].chName+" "+e,o[n].push(a),c[n][a]=chData[e]);for(var l=0;l<o.length;l++)r[l]=o[l].sort(),2==chSortType&&(r[l]=r[l].reverse());for(var h=1,s=0;s<r.length;s++)for(var i=0;i<r[s].length;i++)c[s][r[s][i]].pos=h,"favPos"in c[s][r[s][i]]&&(c[s][r[s][i]].favPos=i+1),chData[h]=c[s][r[s][i]],h++}else $("#btn_all span, #fsYellowButton span").html("A-Z")}}function formatMac(e){var a=e.split("-");return a[a.length-1].match(/.{1,2}/g).join(":")}localStorage_getItem("chSortType")?chSortType=localStorage_getItem("chSortType"):chSortType=0,document.addEventListener("cursorStateChange",function(e){e.detail.visibility?onMouseActive():onMouseInactive()},!1),void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,function(){document[hidden]},!0),window.addEventListener("blur",function(){},!1),window.addEventListener("focus",function(){},!1),window.addEventListener("popstate",function(e){}),webOSDev.connection.getStatus({onSuccess:function(e){!1===e.isInternetConnectionAvailable||e.wired||e.wifi},onFailure:function(e){},subscribe:!0});