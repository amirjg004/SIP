"lg"==localStorage_getItem("colorTheme")?$("#ui_colors").attr("href","css/colors/lg.css"):"android"==localStorage_getItem("colorTheme")?$("#ui_colors").attr("href","css/colors/android.css"):"yellow"==localStorage_getItem("colorTheme")?$("#ui_colors").attr("href","css/colors/yellow.css"):"green"==localStorage_getItem("colorTheme")?$("#ui_colors").attr("href","css/colors/green.css"):"violet"==localStorage_getItem("colorTheme")?$("#ui_colors").attr("href","css/colors/violet.css"):$("#ui_colors").attr("href","css/colors/lg.css"),sessionStorage.getItem("ajaxTimeout")&&$.ajaxSetup({timeout:ajaxTimeout});var tvModel=navigator.userAgent,webOSNative=!0;if(localStorage_getItem("myUzer"))var myUzer=localStorage_getItem("myUzer");else myUzer="default-lg";localStorage_getItem("secret")?secret=localStorage_getItem("secret"):secret="",localStorage_getItem("epgId")?epgId=localStorage_getItem("epgId"):epgId="";var privateList=localStorage_getItem("privateList");if(localStorage_getItem("zoomOption")?zoomOption=localStorage_getItem("zoomOption"):zoomOption="original","on"==localStorage_getItem("DST")?DST=1:DST=0,localStorage_getItem("timeTune")){var timeTune=localStorage_getItem("timeTune");DST=Number(DST)+Number(timeTune)}localStorage_getItem("epgTheme")?selectedEPGColor=localStorage_getItem("epgTheme"):selectedEPGColor="#A2835B",-1!=tvModel.indexOf("Media")?mediaDevice=!0:mediaDevice=!1,(currentDate=new Date).setHours(currentDate.getHours()+DST);var menuChannelCookie="currentChannel",menuPageCookie="currentPage",menuPrevChCookie="previousChannel",scriptsPath="https://scr.siptv.app/common/scripts/",epgPath="https://epg.siptv.app/common/scripts/",imagesPath="",iconsPath="https://img.siptv.app/",pageItems=24,pageBackItems=24,currentDate=new Date,offsetMinutes=currentDate.getTimezoneOffset(),offsetHours=offsetMinutes/60-DST,channelCount=localStorage_getItem("chCount"),chanSelected=localStorage_getItem("arcChannel"),arcOffset=localStorage_getItem("arcOffset"),entryPoint=localStorage_getItem("arcEntry");localStorage_getItem("arcDay")?dayNr=localStorage_getItem("arcDay"):dayNr=0,backPath="archive"==entryPoint?"archive.html?chan="+chanSelected+"&day="+dayNr:"fullscreen.html?chan="+chanSelected;var jumpStep,getChUrlArcTO,arcEPGData,ibarTimeOut,bufferInterval,urlUDP,playPosInterval,bcEPGInterval,bcEPGTimeout,arcJump=arcOffset,playPos=0,playPosSec=0,playPosDelay=1e3,nowUTC=Math.floor((new Date).getTime()/1e3),retryCount=0,scrollPosition=0,chanInfoHeight=0,progScrollHeight=0,containerOn=!1,permInfobar=!1,clockOn=!1,mouseOn=!1,keyNrOn=!1,audioWindow=(containerOn=!1,!1),subsWindow=!1,audioSet=!1,audioIDSelected=0,audioPrevIDSelected=0,audioOKPressed=!1,audioInfoReady=!1,subsSet=!1,subsIDSelected=0,subsPrevIDSelected=0,subsOKPressed=!1,subsInfoReady=!1,bcastExecuted=!1,bcChannelsLoaded=!1,dvbAddress=[],bcEPG=!1,bcPeek=!1,dvbLive=!1,dvbS=!1,result="";chanHistory=[],historyExecuted=!1,chInfoExecuted=!1;var firstLoad=!0;function initPage(){video=document.getElementById("video"),setCurrentTime(),setInterval(setCurrentTime,1e4),loadChInfo(),rebindKeys(),arcJqEvents(),"on"==localStorage_getItem("fsClock")&&clockToggle(),wosBufferingInfo(),$("#btn_audio").css("visibility","visible"),colorize()}function colorize(){$("#menu_channelInfoTitle, #menu_channelInfoNext").css("color",selectedEPGColor),$("#channelTime1, #channelTime2, #channelEPGnow, #channelEPGlater, #channelLeft1, #channelLeft2").css("color",selectedEPGColor),$("#channelInfoTitle").css("color",selectedEPGColor)}function keyEvents(){switch(event.which){case VK_PAUSE:case VK_A:arcPause();break;case VK_PLAY:case VK_P:arcPlay();break;case VK_STOP:window.location.reload(!0);break;case VK_RIGHT:jumpStep=60,arcPlayFF();break;case VK_LEFT:jumpStep=60,arcPlayRW();break;case VK_FAST_FWD:jumpStep=60,arcPlayFF();break;case VK_REWIND:jumpStep=60,arcPlayRW();break;case VK_UP:containerOn?infoScrollUp(40):showDescription();break;case VK_DOWN:containerOn&&infoScrollDown(40);break;case VK_BACK:case VK_B:"block"!=$("#infoBar").css("display")||mouseOn?window.location.replace(backPath):(hideInfo(),chanDescriptionScrollReset());break;case VK_INFO:case VK_I:showDescription();break;case VK_RED:case VK_R:audioInfoReady&&chooseAudioLang();break;case VK_YELLOW:case VK_Y:clockToggle();break;case VK_ENTER:clearTimeout(ibarTimeOut),permInfobar=!0,showInfo();break;case VK_BLUE:case VK_L:localStorage_setItem("backPath","archive"),window.location.replace("settings.html")}}function fsAudioKeyEvents(){$(document).unbind("keydown keyup").keydown(function(){switch(event.keyCode){case VK_ENTER:setAudioLang();break;case VK_UP:selectAudioLang(-1);break;case VK_DOWN:selectAudioLang(1);break;case VK_RED:case VK_R:chooseAudioLang();break;case VK_GREEN:case VK_G:chooseSubsLang();break;case VK_BACK:case VK_B:chooseAudioLang()}})}function fsSubsKeyEvents(){$(document).unbind("keydown keyup").keydown(function(e){switch(e.keyCode){case VK_ENTER:setSubsLang();break;case VK_UP:selectSubsLang(-1);break;case VK_DOWN:selectSubsLang(1);break;case VK_RED:case VK_R:chooseAudioLang();break;case VK_GREEN:case VK_G:chooseSubsLang();break;case VK_BACK:case VK_B:chooseSubsLang()}})}function arcJqEvents(){$("#btn_info").click(function(){showDescription()}),$("#btn_pause").click(function(){arcPlayPause()}),$("#btn_right").click(function(){jumpStep=60,arcPlayFF()}),$("#btn_left").click(function(){jumpStep=60,arcPlayRW()}),$("#btn_clock").click(function(){clockToggle()}),$("#btn_qmenu").mouseover(function(){showPrefButtons()}),$("#btn_qmenu").click(function(){localStorage_setItem("backPath","archive"),window.location.replace("settings.html")}),$("#btn_back").click(function(){window.location.replace(backPath)}),$("#btn_audio").click(function(){audioInfoReady&&chooseAudioLang()}),$("#audioToolPanel").click(function(){chooseSubsLang()}),$("#fsClock").click(function(){window.location.reload(!0)})}function showPrefButtons(){$(".pref_button").show()}function clockToggle(){clockOn?($("#fsClock").hide(),clockOn=!1,localStorage_setItem("fsClock","off")):($("#fsClock").show(),clockOn=!0,localStorage_setItem("fsClock","on"))}function onMouseActive(){$(".button, #infoBar").show(),clearTimeout(ibarTimeOut),mouseOn=!0}function onMouseCursorOn(){}function onMouseInactive(){"none"!=$("#channelInfo").css("display")?$(".button, .pref_button").hide():$(".button, .pref_button, #infoBar").hide(),mouseOn=!1}function showInfo(){"none"==$("#infoBar").css("display")?($("#bufferingInfo").hide(),$("#infoBar").show()):($("#infoBar").hide(),$("#channelInfo").hide(),permInfobar=!1)}function hideInfo(){mouseOn||$("#infoBar, #channelInfo").hide(),$("#bufferingInfo").hide()}function showDescription(){document.getElementById("channelInfo"),document.getElementById("channelInfoTitle").innerHTML,document.getElementById("infoBar"),"none"==$("#channelInfo").css("display")&&"none"==$("#infoBar").css("display")?($("#infoBar").show(),ibarTimeOut=setTimeout(hideInfo,5e3)):"none"==$("#channelInfo").css("display")&&"block"==$("#infoBar").css("display")?""!=$("#channelInfoTitle").html()?(containerOn=!0,document.addEventListener("mousewheel",infoMouseScroll,!1),$("#channelInfo").show(),""!=$("#channelInfoDesc").html()&&"<p></p>"!=$("#channelInfoDesc").html()&&$(".channelInfoTitle").css("padding-bottom","15px"),$("#channelInfoContent")[0].scrollHeight>$("#channelInfoContent").height()&&($("#channelInfoContent").css("margin-right","16px"),progScrollHeight=$("#channelInfoContent")[0].scrollHeight,chanInfoHeight=$("#channelInfoContent").height(),$("#channelInfoProgress").show(),$("#infoProgRunner").css("height",chanInfoHeight/progScrollHeight*$("#channelInfoProgress").height()+"px"),scrollPosition=0,$("#channelInfoContent").scrollTop(0),$("#infoProgRunner").css("top","0")),clearTimeout(ibarTimeOut)):($("#channelInfo").hide(),$("#infoBar").hide(),$(".channelInfoTitle").css("padding-bottom","0px"),$(".channelInfoMiddle").css("padding-bottom","10px"),clearTimeout(ibarTimeOut)):(chanDescriptionScrollReset(),$("#channelInfo, #channelInfoProgress").hide(),mouseOn||$("#infoBar").hide(),$(".channelInfoTitle").css("padding-bottom","0px"),$(".channelInfoMiddle").css("padding-bottom","10px"),$("#channelInfoContent").css("margin-right","0px"))}function refreshStream(){getChUrl(),clearChEPG(),getChName(),$("#infoBar").show(),permInfobar||(ibarTimeOut=setTimeout(hideInfo,6e3))}function setBufferingInfo1(){var e=document.getElementById("video").mediaPlayInfo(),o=(e.bitrateInstant/1e6).toFixed(2);(e.bitrateTarget/1e6).toFixed(2),o>0?$("#bitrateValue").html(o+" Mbit/s"):$("#bitrateValue").html("Buffering...")}function setCurrentTime(){var e=new Date;if(e.setHours(e.getHours()+DST),e.getMinutes()>=0&&e.getMinutes()<=9)var o="0"+e.getMinutes();else o=e.getMinutes();document.getElementById("currentTime").innerHTML=e.getHours()+":"+o,document.getElementById("fsClock").innerHTML=e.getHours()+":"+o}function playPositionPlus(){playPos+=1,playPosSec+=1,updateChEPG()}function arcPlayFF(){playPos=playPos+jumpStep+1,arcJump=Number(arcOffset)+playPos+1,playPosSec=0,getChUrlArcTO&&clearTimeout(getChUrlArcTO),getChUrlArcTO=setTimeout(getChUrlArc,1e3),clearTimeout(ibarTimeOut),updateChEPG(),$("#infoBar").show(),$("#btn_pause").html('<img src="images/new/icon_pause.svg" />')}function arcPlayRW(){(playPos=playPos-jumpStep-1)<=0?(playPos=0,arcJump=arcOffset):arcJump=arcJump+playPosSec-jumpStep-1,playPosSec=0,getChUrlArcTO&&clearTimeout(getChUrlArcTO),setTimeout(getChUrlArc,1e3),clearTimeout(ibarTimeOut),updateChEPG(),$("#infoBar").show(),$("#btn_pause").html('<img src="images/new/icon_pause.svg" />')}function arcPlayPause(){1==video.playState||webOSNative&&!video.paused?(webOSNative?video.pause():video.play(0),clearTimeout(ibarTimeOut),clearInterval(playPosInterval),$("#infoBar").show(),$("#btn_pause").html('<img src="images/new/icon_play.svg" />')):(updateChUrlArc(),webOSNative?video.play():video.play(1),playPosInterval=setInterval(playPositionPlus,playPosDelay),clearTimeout(ibarTimeOut),permInfobar||(ibarTimeOut=setTimeout(hideInfo,3e3)),$("#btn_pause").html('<img src="images/new/icon_pause.svg" />'))}function arcPause(){webOSNative?video.pause():video.play(0),clearTimeout(ibarTimeOut),clearInterval(playPosInterval),$("#infoBar").show(),$("#btn_pause").html('<img src="images/new/icon_play.svg" />')}function arcPlay(){updateChUrlArc(),webOSNative?video.play():video.play(1),playPosInterval=setInterval(playPositionPlus,playPosDelay),clearTimeout(ibarTimeOut),$("#infoBar").show(),permInfobar||(ibarTimeOut=setTimeout(hideInfo,3e3)),$("#btn_pause").html('<img src="images/new/icon_pause.svg" />')}function getChEPG(){$.ajax({method:"GET",url:epgPath+"get_epg_archive.php",data:{channel:chNr,day:arcJump,epgId:epgId},dataType:"json"}).done(function(e){for(arcEPGData=e,nowTest=new Date,nowTest.setTime(arcOffset),a=0;a<e.epg.length;a++)if(arcOffset==e.start[a]){if($("#channelEPGnow").html(e.epg[a]),$("#channelInfoTitle").html(e.epg[a]),progStart=new Date(1e3*e.start[a]),progStartHours=progStart.getHours(),progStartHours+=DST,progStartMinutes=progStart.getMinutes(),progStartHours>=24?progStartHours-=24:progStartHours<0&&(progStartHours+=24),progStartHours<10&&(progStartHours="0"+progStartHours),progStartMinutes<10&&(progStartMinutes="0"+progStartMinutes),progStop=new Date(1e3*e.stop[a]),progStopHours=progStop.getHours(),progStopHours+=DST,progStopMinutes=progStop.getMinutes(),progStopHours>=24?progStopHours-=24:progStopHours<0&&(progStopHours+=24),progStopHours<10&&(progStopHours="0"+progStopHours),progStopMinutes<10&&(progStopMinutes="0"+progStopMinutes),$("#channelTime1").html(progStartHours+":"+progStartMinutes+" - "+progStopHours+":"+progStopMinutes),playLength=(e.stop[a]-e.start[a])/60,playLeft=(6e4*playLength-playPos*playPosDelay)/6e4,$("#channelLeft1").html("+"+Math.ceil(playLeft)),playLeft>=0){var o=playLength/playLength*1e3;$(".progress").css({width:o,"max-width":"100%"});var t=Math.round((playLength-playLeft)/playLength*1e3);$("#bar").css({width:t,"max-width":"100%"})}e.desc&&e.desc[a]&&$("#channelInfoDesc").html("<p>"+e.desc[a]+"</p>")}}).fail(function(){clearChEPG()})}function updateChEPG(){if(null!=arcEPGData){if(playLeft=(6e4*playLength-playPos*playPosDelay)/6e4,playLeft<0&&(arcOffset=Number(arcOffset)+60*playLength,arcJump=arcOffset+playPos-60*playLength,playPos-=60*playLength,getChEPG(),$("#infoBar").show()),0==playLeft&&(clearInterval(playPosInterval),playPos=0,arcOffset=Number(arcOffset)+60*playLength,playPosInterval=setInterval(playPositionPlus,playPosDelay)),playLeft>=0){$("#channelLeft1").html("+"+Math.ceil(playLeft));var e=playLength/playLength*1e3;$(".progress").css({width:e,"max-width":"100%"});var o=Math.round((playLength-playLeft)/playLength*1e3);$("#bar").css({width:o,"max-width":"100%"})}}else clearChEPG()}function clearChEPG(){$("#channelEPGnow").html(""),$("#channelEPGlater").html(""),$("#channelInfoTitle").html(""),$("#channelInfoDesc").html(""),$("#channelTime1").html(""),$("#channelTime2").html(""),$("#channelLeft1").html(""),$("#channelLeft2").html(""),$(".progress").css({width:0}),$("#bar").css({width:0})}function loadChInfo(){chData=JSON.parse(sessionStorage.getItem("arcChannelData")),processChData()}function processChData(){chNr=chData.chNr,chUrl=chData.chUrl,chFavPos=chData.favPos,chFavPos?($("#channelNumber").html(chData.favPos),$("#channelNmFav").show()):($("#channelNumber").html(chData.pos),$("#channelNmFav").hide()),$("#channelName span").html(chData.chName),$("#channelName").textfill({maxFontPixels:28}),$("#chPicon").css({background:"url("+iconsPath+"icons/"+chNr+".png) no-repeat right center"}),-1!=chData.chUrl.indexOf("?")?arcPlayLink=chData.chUrl+"&utc="+arcJump+"&lutc="+nowUTC:arcPlayLink=chData.chUrl+"?utc="+arcJump+"&lutc="+nowUTC,playURL=arcPlayLink,chData.chUdp?urlUDP=chData.chUdp:(urlUDP=!1,urlUDPAuto=!1),!urlUDP&&urlUDPAuto&&(urlUDP=urlUDPAuto),chanZapper(),clearInterval(playPosInterval),playPosInterval=setInterval(playPositionPlus,playPosDelay),getChEPG()}function getChUrlArc(){nowUTC=Math.floor((new Date).getTime()/1e3),-1!=chData.chUrl.indexOf("?")?arcPlayLink=chData.chUrl+"&utc="+arcJump+"&lutc="+nowUTC:arcPlayLink=chData.chUrl+"?utc="+arcJump+"&lutc="+nowUTC,$("#bitrateValue").html("Buffering..."),$("#video").unbind("emptied"),$("#video source").attr("src",arcPlayLink),video.load(),wosBufferingInfo(),clearInterval(playPosInterval),playPosInterval=setInterval(playPositionPlus,playPosDelay)}function updateChUrlArc(){arcJump=Number(arcOffset)+playPos,nowUTC=Math.floor((new Date).getTime()/1e3),-1!=chData.chUrl.indexOf("?")?arcPlayLink=chData.chUrl+"&utc="+arcJump+"&lutc="+nowUTC:arcPlayLink=chData.chUrl+"?utc="+arcJump+"&lutc="+nowUTC,$("#video source").attr("src",arcPlayLink)}function clearChProgress(){for(g=1;g<=pageItems;g++)$("#"+g+"_innerObjProgress").css({background:"none"})}function chanZapper(){$("#bitrateValue").html("Buffering..."),$("#video").unbind("emptied"),$("#video").empty();var e={};-1!=playURL.indexOf("m3u8")?e.mediaTransportType="HLS":e.mediaTransportType="URI",e.htmlMediaOption={},e.htmlMediaOption.useUMSMediaInfo=!0,subsOn=!0,e.option={},e.option.subtitle={},e.option.subtitle.show=subsOn;var o=escape(JSON.stringify(e)),t=document.createElement("source");t.setAttribute("src",playURL),videoType="video/mp4",t.setAttribute("type",videoType+";mediaOption="+o),video.appendChild(t),video.load(),video.addEventListener("umsmediainfo",function(e){handleUMSMediaInfo(e.detail)},!1)}function chanDescriptionScroll(e){$(document).keydown(function(o){switch(o.which){case 40:infoScrollDown(e);break;case 38:infoScrollUp(e)}})}function infoMouseScroll(){containerOn&&(window.event.wheelDelta>0?infoScrollUp(40):infoScrollDown(40))}function infoScrollUp(e){1==containerOn&&((scrollPosition-=e)<0&&(scrollPosition=0),$("#channelInfoContent").scrollTop(scrollPosition),calcProgMovement(),$("#infoProgRunner").css("top",progMovement+"px"),event.preventDefault())}function infoScrollDown(e){1==containerOn&&((scrollPosition+=e)+chanInfoHeight>progScrollHeight&&(scrollPosition=progScrollHeight-chanInfoHeight),$("#channelInfoContent").scrollTop(scrollPosition),calcProgMovement(),$("#infoProgRunner").css("top",progMovement+"px"),event.preventDefault())}function calcProgMovement(){progMovement=Math.round($("#channelInfoProgress").height()*$("#channelInfoContent").scrollTop()/progScrollHeight)}function chanDescriptionScrollReset(){$("#channelInfoContent").scrollTop(0),valueIncrement=0,containerOn=!1}function toggleDebugWindow(){debugWindow=!debugWindow,debugWindow?$("#debugWindow").hide():$("#debugWindow").show()}function toggleAudioLanguage(){1==video.playState?changeLanguage():setTimeout(toggleAudioLanguage,500)}function changeLanguage(){video.audioLanguage=urlUDP}window.onload=initPage,window.onmousemove=onMouseActive,window.onmouseon=onMouseCursorOn,window.onmouseoff=onMouseInactive;