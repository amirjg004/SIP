var mbitSec,bufferInterval,retryTimeOut,videoSizeTimeout,renderCompleteTimeout,bufferWinTimeout,retryCount=0,renderComplete=!1;function pauseVideo(){webOSNative?video.pause():video.play(0)}function resumeVideo(){webOSNative?video.play():video.play(1)}function restartVideo(){renderComplete||(clearTimeout(ibarTimeOut),"none"==$("#infoBar").css("display")?($("#bufferingInfo").show(),$("#bufferingText").html("Restarting...")):$("#bitrateValue").html("Restarting...")),webOSNative?($("#video").unbind("emptied"),video.load()):(renderComplete||video.stop(),video.play(1)),$("#btn_pause").html('<img src="images/new/icon_pause.svg" />')}function livePlay(){longPress?(permInfobar=!permInfobar,clearTimeout(ibarTimeOut),"none"==$("#infoBar").css("display")?showInfo():permInfobar||hideInfo()):(webOSNative&&!video.paused||!webOSNative&&1==video.playState?(showInfo(),clearTimeout(ibarTimeOut),permInfobar||(ibarTimeOut=setTimeout(hideInfo,4e3)),mouseOn=!1):(webOSNative&&video.paused||!webOSNative&&2==video.playState)&&($("#bitrateValue").html("Resumed"),"none"==$("#infoBar").css("display")&&($("#bufferingInfo").show(),$("#bufferingText").html("Resume")),clearTimeout(ibarTimeOut),permInfobar||(ibarTimeOut=setTimeout(hideInfo,3e3)),clearTimeout(bufferWinTimeout),resumeVideo()),$("#btn_pause").html('<img src="images/new/icon_pause.svg" />'))}function livePause(){longPress?"demo"!=myUzer&&("none"==$("#infoBar").css("display")&&showInfo(),clearTimeout(ibarTimeOut),toggleDebugWindow(),"none"==$("#debugWindow").css("display")&&(permInfobar||(ibarTimeOut=setTimeout(hideInfo,3e3)))):("none"==$("#infoBar").css("display")&&($("#bufferingInfo").show(),$("#bufferingText").html("Pause")),clearTimeout(ibarTimeOut),permInfobar||(ibarTimeOut=setTimeout(hideInfo,3e3)),clearTimeout(bufferWinTimeout),pauseVideo(),$("#btn_pause").html('<img src="images/new/icon_play.svg" />'))}function setBufferingInfo(){video.onPlayStateChange=playStateChangeFunction}function handleUMSMediaInfo(e){var i=JSON.parse(e);if("sourceInfo"==i.type){i.info.numPrograms>0&&(videoInfo=i.info.programInfo[0],numAudioTracks=videoInfo.numAudioTracks,numVideoTracks=videoInfo.numVideoTracks,numTextTracks=videoInfo.numSubtitleTracks),audioCode="",audioTrackSet=!1,audioCount=0,audioLangID=[],audioLangNameArray=[],audioCodecNameArray=[],subsCount=0,subsLangID=[],subsLangNameArray=[],videoCount=0,videoTrackResolution=[],videoTrackFramerate=[];for(var o=0,r=0,t=0;t<numVideoTracks;t++)videoInfo.videoTrackInfo[t].frameRate&&(videoTrackFramerate[0]="x"+videoInfo.videoTrackInfo[t].frameRate);for(var a=0;a<numAudioTracks;a++)audioCount++,videoInfo.audioTrackInfo[a].language?audioLangNameArray[o]=videoInfo.audioTrackInfo[a].language:audioLangNameArray[o]="Audio "+(a+1),"mpeg"!=videoInfo.audioTrackInfo[a].codec?audioCodecNameArray[o]=videoInfo.audioTrackInfo[a].codec:audioCodecNameArray[o]="",audioLangID[o]=a,o++,urlUDP&&videoInfo.audioTrackInfo[a].language==urlUDP&&(audioCode=a);audioInfoReady=!0;for(var n=0;n<numTextTracks;n++)subsCount++,videoInfo.subtitleTrackInfo[n].language&&"und"!=videoInfo.subtitleTrackInfo[n].language?subsLangNameArray[r]=videoInfo.subtitleTrackInfo[n].language:subsLangNameArray[r]="Subtitles "+(n+1),subsLangID[r]=n,r++;subsCount>0&&(subsCount++,subsLangNameArray.push("Subs Off"),subsLangID.push(subsCount)),subsIDSelected=subsCount-1,subsPrevIDSelected=subsIDSelected}}function wosBufferingInfo(){clearTimeout(videoSizeTimeout),$("#video").bind("canplaythrough ratechange playing durationchange resize suspend loadedmetadata volumechange abort loadeddata canplay pause waiting error play seeking seeked ended playing progress stalled timeupdate emptied loadstart",function(e){}),$("#video").bind("timeupdate stalled",function(e){clearTimeout(renderCompleteTimeout),!video.paused&&video.readyState>2&&-1==video.currentSrc.indexOf("tv://")&&(renderCompleteTimeout=setTimeout(OnRenderingComplete,1e3))}),$("#video").bind("ended",function(e){OnRenderingComplete()}),$("#video").bind("pause abort progress",function(e){"pause"==e.type&&$("#bitrateValue").html("Paused"),clearTimeout(renderCompleteTimeout)}),$("#video").bind("loadstart",function(e){$("#video").bind("emptied",function(e){retryTimeOut=setTimeout(retryOnError,1e3)})}),$("#video").bind("resize",function(e){clearTimeout(renderCompleteTimeout),clearTimeout(videoSizeTimeout),videoSizeTimeout=setTimeout(function(){video.videoWidth>0&&$("#bitrateValue").html(video.videoWidth+"x"+video.videoHeight),$("#bufferingText").html("Live")},500)}),$("#video").bind("error",function(e){retryTimeOut=setTimeout(retryOnError,1e3)}),$("#video").bind("loadedmetadata",function(e){}),$("#video").bind("canplaythrough",function(e){}),$("#video").bind("playing",function(e){getAudioLang(),getSubsLang(),retryCount=0,renderComplete=!1,$("#bitrateValue").html("Live"),clearTimeout(videoSizeTimeout),videoSizeTimeout=setTimeout(function(){video.videoWidth>0&&$("#bitrateValue").html(video.videoWidth+"x"+video.videoHeight),$("#bufferingText").html("Live")},500),clearTimeout(bufferWinTimeout),bufferWinTimeout=setTimeout('$("#bufferingInfo").hide();',1600),clearTimeout(ibarTimeOut),permInfobar||"none"!=$("#channelInfo").css("display")||(ibarTimeOut=setTimeout(hideInfo,4e3))}),$("#video").bind("waiting",function(e){clearTimeout(ibarTimeOut),clearTimeout(bufferWinTimeout),clearTimeout(videoSizeTimeout),clearTimeout(renderCompleteTimeout),renderComplete||showBufferingText()})}function showBufferingText(){"none"==$("#infoBar").css("display")?($("#bufferingInfo").show(),0==retryCount?$("#bufferingText").html("Buffering..."):$("#bufferingText").html("Retrying "+retryCount+"...")):(clearTimeout(ibarTimeOut),clearInterval(bufferInterval),0==retryCount?$("#bitrateValue").html("Buffering..."):$("#bitrateValue").html("Retrying "+retryCount+"..."))}function playStateChangeFunction(){switch(video.playState){case 1:OnStreamInfoReady();break;case 2:OnStreamPaused();break;case 3:OnConnection();break;case 4:OnBufferingProgress();break;case 5:OnRenderingComplete();break;case 6:OnConnectionFailed()}}function OnStreamInfoReady(){-1!=chData[chanSelected].chUrl.indexOf("udp://")&&$("#bitrateValue").html("Multicast"),retryCount=0,renderComplete=!1,0==mbitSec&&$("#bitrateValue").html("Live"),clearTimeout(videoSizeTimeout),videoSizeTimeout=setTimeout(function(){$("#bufferingText").html("Live")},800),clearTimeout(bufferWinTimeout),bufferWinTimeout=setTimeout('$("#bufferingInfo").hide();',1600),clearInterval(bufferInterval),bufferInterval=setInterval(getBufferingInfo,500),clearTimeout(ibarTimeOut),permInfobar||"none"!=$("#channelInfo").css("display")||(ibarTimeOut=setTimeout(hideInfo,4e3))}function OnStreamPaused(){$("#bitrateValue").html("Paused")}function getBufferingInfo(){bcastExecuted?dvbLive?$("#bitrateValue").html("DVB Live"):$("#bitrateValue").html("External Live"):(playInfo=video.mediaPlayInfo(),mbitSec=(playInfo.bitrateInstant/1e6).toFixed(2),isNaN(mbitSec)?$("#bitrateValue").html("No bitrate"):mbitSec>0&&2!=video.playState&&$("#bitrateValue").html(mbitSec+" Mbit/s"))}function OnConnection(){clearInterval(bufferInterval),$("#bitrateValue").html("Connecting...")}function OnBufferingProgress(){renderComplete||showBufferingText()}function OnRenderingComplete(){bcastExecuted||(renderComplete=!0,restartVideo())}function OnConnectionFailed(){switch(video.error){case 0:errorCode="Unsupported format!";break;case 1:errorCode="Cannot connect!";break;case 2:errorCode="Stream error!";break;case 1e3:errorCode="File not found!";break;case 1001:errorCode="Invalid protocol!";break;case 1002:errorCode="DRM failure!";break;case 1003:errorCode="Playlist empty!";break;case 1004:errorCode="Unrecognized playlist!";break;case 1005:errorCode="Invalid ASX format!";break;case 1006:errorCode="Error in downloading playlist!";break;case 1007:errorCode="Out of memory!";break;case 1008:errorCode="Invalid URL list format!";break;case 1009:errorCode="Not playable in playlist!";break;case 1100:errorCode="Unidentified WM-DRM error!";break;case 1101:errorCode="Incorrect license!";break;case 1102:errorCode="Fail in receiving correct license!";break;case 1103:errorCode="Stored license is expired!"}clearInterval(bufferInterval),$("#bitrateValue").html(errorCode),retryTimeOut=setTimeout(retryOnError,1e3)}function retryOnError(){clearTimeout(retryTimeOut),$("#video").unbind("emptied error"),(retryCount+=1)<4?($("#bitrateValue").html("Retrying "+retryCount+"..."),webOSNative?"OBJECT"==$("#video").prop("tagName")?(video.stop(),video.play(1)):video.load():(video.stop(),video.play(1))):$("#bitrateValue").html("Cannot connect!")}